<h1>Issues</h1>
<div class="col-md-7" id="map-container">
  <div id="map-canvas"></div>
</div>
<div class="col-md-5">
<%= render 'list' %>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqz5pjoBwTK_p-nQ7g3xBSHGD7RWl0jJE&sensor=false"></script>
<%= javascript_tag do %>
  $( document ).ready(function() {
    var map = new google.maps.Map($('#map-container')[0], {
      zoom: 12,
      center: new google.maps.LatLng(48.8566,2.3522),
      mapTypeId: google.maps.MapTypeId.SATELLITE
    });

    var infowindow = new google.maps.InfoWindow();

    <% @issues.each do |issue| %>
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(<%= issue.latitude %>, <%= issue.longitude %>),
        map: map
      });

      var contentString = '<div id="content">'+
            '<div class="issue-label"><span class="issue-state <%= issue.state %>">&nbsp;</span></div>' +
            '<h2><%= issue.category.capitalize %></h2>'+
            '<div id="bodyContent">'+
            '<div class="issuePic">'+
            '<img src="<%= issue.image %>"/>' +
            '</div>'+
            '<p><%= issue.category %>' +
            '</p>'+
            '<span class="date">Created at <%= issue.created_at.strftime("%y-%m-%d") %>' +
            '</span>'+
            '</div>'+
            '</div>';

      var infowindow = new google.maps.InfoWindow({
                         content: contentString
                      });
      marker.addListener('click', function() {
               infowindow.open(map, marker);
             });
      issueTr=$("#issue-list").find("#<%= issue.id %>");
      $(issueTr).click(function() {
               infowindow.open(map, marker);
             });
    <% end %>
  });
<% end -%>
